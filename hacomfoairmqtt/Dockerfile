ARG BUILD_FROM
FROM $BUILD_FROM

ENV COMFOAIR_IP="192.168.40.130"
ENV COMFOAIR_PORT="8899"
ENV SERIAL_PORT="/config/comfoair"
ENV RS485_PROTOCOL="False"
ENV REFRESH_INTERVAL="10"
ENV ENABLE_PC_MODE="False"
ENV DEBUG="False"
ENV FAN_OUT_ABSENT="15"
ENV FAN_OUT_LOW="30"
ENV FAN_OUT_MID="50"
ENV FAN_OUT_HIGH="70"
ENV FAN_IN_ABSENT="15"
ENV FAN_IN_LOW="30"
ENV FAN_IN_MID="50"
ENV FAN_IN_HIGH="70"
ENV SETUP_FAN_LEVELS_AT_START="True"
ENV MQTT_SERVER="mosquitto.domain.tld"
ENV MQTT_PORT="1883"
ENV MQTT_KEEPALIVE="45"
ENV MQTT_USER="username"
ENV MQTT_PASSWORD="password"
ENV HA_ENABLE_AUTO_DISCOVERY_SENSORS="True"
ENV HA_ENABLE_AUTO_DISCOVERY_CLIMATE="True"
ENV HA_AUTO_DISCOVERY_DEVICE_ID="ca350"
ENV HA_AUTO_DISCOVERY_DEVICE_NAME="CA350"
ENV HA_AUTO_DISCOVERY_DEVICE_MANUFACTURER="Zehnder"
ENV HA_AUTO_DISCOVERY_DEVICE_MODEL="ComfoAir 350"

WORKDIR /app

COPY src/ /app/

RUN pip3 install --no-cache-dir -r /app/requirements.txt

COPY run.sh /app/run.sh
RUN chmod +x /app/run.sh

CMD ["/app/run.sh"]